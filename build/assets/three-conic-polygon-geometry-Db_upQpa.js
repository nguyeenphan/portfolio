import{B as or,z as ar}from"./three-okop3vLy.js";import{f as D,e as ir}from"./earcut-CvUQtzTa.js";import{D as ur}from"./delaunator-DOM67N16.js";import{t as sr}from"./@turf-DYIdlq4y.js";import{m as q,e as X,d as fr}from"./d3-array-DwlNfeyV.js";import{d as rr,e as cr,c as lr,f as vr}from"./d3-geo-IBeQgcAP.js";import{g as mr}from"./d3-geo-voronoi-BKtEqr6Z.js";import{l as Y}from"./d3-scale-CVvUltm_.js";function H(r,t){(t==null||t>r.length)&&(t=r.length);for(var n=0,e=Array(t);n<t;n++)e[n]=r[n];return e}function pr(r){if(Array.isArray(r))return r}function gr(r){if(Array.isArray(r))return H(r)}function dr(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}function hr(r,t,n){return t=z(t),Mr(r,tr()?Reflect.construct(t,[],z(r).constructor):t.apply(r,n))}function yr(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}function br(r,t,n){return Object.defineProperty(r,"prototype",{writable:!1}),r}function z(r){return z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},z(r)}function _r(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),t&&J(r,t)}function tr(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tr=function(){return!!r})()}function Pr(r){if(typeof Symbol<"u"&&r[Symbol.iterator]!=null||r["@@iterator"]!=null)return Array.from(r)}function wr(r,t){var n=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(n!=null){var e,o,s,u,a=[],f=!0,i=!1;try{if(s=(n=n.call(r)).next,t!==0)for(;!(f=(e=s.call(n)).done)&&(a.push(e.value),a.length!==t);f=!0);}catch(m){i=!0,o=m}finally{try{if(!f&&n.return!=null&&(u=n.return(),Object(u)!==u))return}finally{if(i)throw o}}return a}}function Lr(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ar(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Mr(r,t){if(t&&(typeof t=="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dr(r)}function J(r,t){return J=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,e){return n.__proto__=e,n},J(r,t)}function L(r,t){return pr(r)||wr(r,t)||nr(r,t)||Lr()}function W(r){return gr(r)||Pr(r)||nr(r)||Ar()}function nr(r,t){if(r){if(typeof r=="string")return H(r,t);var n={}.toString.call(r).slice(8,-1);return n==="Object"&&r.constructor&&(n=r.constructor.name),n==="Map"||n==="Set"?Array.from(r):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(r,t):void 0}}function Or(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.resolution,e=n===void 0?1/0:n,o=Br(r,e),s=q(o),u=Cr(r,e),a=[].concat(W(s),W(u)),f={type:"Polygon",coordinates:r},i=rr(f),m=L(i,2),_=L(m[0],2),P=_[0],T=_[1],g=L(m[1],2),B=g[0],c=g[1],h=P>B||c>=89||T<=-89,C=[];if(h){var S=mr(a).triangles(),k=new Map(a.map(function(l,b){var d=L(l,2),v=d[0],O=d[1];return["".concat(v,"-").concat(O),b]}));S.features.forEach(function(l){var b,d=l.geometry.coordinates[0].slice(0,3).reverse(),v=[];if(d.forEach(function(U){var w=L(U,2),N=w[0],er=w[1],Q="".concat(N,"-").concat(er);k.has(Q)&&v.push(k.get(Q))}),v.length===3){if(v.some(function(U){return U<s.length})){var O=l.properties.circumcenter;if(!K(O,f,h))return}(b=C).push.apply(b,v)}})}else if(u.length)for(var M=ur.from(a),E=function(b){var d,v=[2,1,0].map(function(w){return M.triangles[b+w]}),O=v.map(function(w){return a[w]});if(v.some(function(w){return w<s.length})){var U=[0,1].map(function(w){return fr(O,function(N){return N[w]})});if(!K(U,f,h))return 1}(d=C).push.apply(d,W(v))},G=0,y=M.triangles.length;G<y;G+=3)E(G);else{var R=D(o),A=R.vertices,p=R.holes,j=p===void 0?[]:p;C=ir(A,j,2)}var V=Y(X(a,function(l){return l[0]}),[0,1]),x=Y(X(a,function(l){return l[1]}),[0,1]),$=a.map(function(l){var b=L(l,2),d=b[0],v=b[1];return[V(d),x(v)]}),I={points:a,indices:C,uvs:$};return{contour:o,triangles:I}}function Br(r,t){return r.map(function(n){var e=[],o;return n.forEach(function(s){if(o){var u=lr(s,o)*180/Math.PI;if(u>t)for(var a=vr(o,s),f=1/Math.ceil(u/t),i=f;i<1;)e.push(a(i)),i+=f}e.push(o=s)}),e})}function Cr(r,t){var n={type:"Polygon",coordinates:r},e=rr(n),o=L(e,2),s=L(o[0],2),u=s[0],a=s[1],f=L(o[1],2),i=f[0],m=f[1];if(Math.min(Math.abs(i-u),Math.abs(m-a))<t)return[];var _=u>i||m>=89||a<=-89;return jr(t,{minLng:u,maxLng:i,minLat:a,maxLat:m}).filter(function(P){return K(P,n,_)})}function jr(r){for(var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=t.minLng,e=t.maxLng,o=t.minLat,s=t.maxLat,u=Math.round(Math.pow(360/r,2)/Math.PI),a=(1+Math.sqrt(5))/2,f=function(h){return h/a*360%360-180},i=function(h){return Math.acos(2*h/u-1)/Math.PI*180-90},m=function(h){return u*(Math.cos((h+90)*Math.PI/180)+1)/2},_=[s!==void 0?Math.ceil(m(s)):0,o!==void 0?Math.floor(m(o)):u-1],P=n===void 0&&e===void 0?function(){return!0}:n===void 0?function(c){return c<=e}:e===void 0?function(c){return c>=n}:e>=n?function(c){return c>=n&&c<=e}:function(c){return c>=n||c<=e},T=[],g=_[0];g<=_[1];g++){var B=f(g);P(B)&&T.push([B,i(g)])}return T}function K(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return n?cr(t,r):sr(r,t)}var F=window.THREE?window.THREE:{BufferGeometry:or,Float32BufferAttribute:ar},Z=new F.BufferGeometry().setAttribute?"setAttribute":"addAttribute",Ur=function(r){function t(n,e,o,s,u,a,f){var i;yr(this,t),i=hr(this,t),i.type="ConicPolygonBufferGeometry",i.parameters={polygonGeoJson:n,startHeight:e,endHeight:o,closedBottom:s,closedTop:u,includeSides:a,curvatureResolution:f},e=e||0,o=o||1,s=s!==void 0?s:!0,u=u!==void 0?u:!0,a=a!==void 0?a:!0,f=f||5;var m=Or(n,{resolution:f}),_=m.contour,P=m.triangles,T=q(P.uvs),g=[],B=[],c=[],h=0,C=function(p){var j=Math.round(g.length/3),M=c.length;g=g.concat(p.vertices),B=B.concat(p.uvs),c=c.concat(j?p.indices.map(function(E){return E+j}):p.indices),i.addGroup(M,c.length-M,h++)};a&&C(k()),s&&C(R(e,!1)),u&&C(R(o,!0)),i.setIndex(c),i[Z]("position",new F.Float32BufferAttribute(g,3)),i[Z]("uv",new F.Float32BufferAttribute(B,2)),i.computeVertexNormals();function S(A,p){var j=A.map(function(M){return M.map(function(E){var G=L(E,2),y=G[0],V=G[1];return Er(V,y,p)})});return D(j)}function k(){for(var A=S(_,e),p=A.vertices,j=A.holes,M=S(_,o),E=M.vertices,G=q([E,p]),y=Math.round(E.length/3),V=new Set(j),x=0,$=[],I=0;I<y;I++){var l=I+1;if(l===y)l=x;else if(V.has(l)){var b=l;l=x,x=b}$.push(I,I+y,l+y),$.push(l+y,l,I)}for(var d=[],v=1;v>=0;v--)for(var O=0;O<y;O+=1)d.push(O/(y-1),v);return{indices:$,vertices:G,uvs:d}}function R(A){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return{indices:p?P.indices:P.indices.slice().reverse(),vertices:S([P.points],A).vertices,uvs:T}}return i}return _r(t,r),br(t)}(F.BufferGeometry);function Er(r,t){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,e=(90-r)*Math.PI/180,o=(90-t)*Math.PI/180;return[n*Math.sin(e)*Math.cos(o),n*Math.cos(e),n*Math.sin(e)*Math.sin(o)]}export{Ur as C};
